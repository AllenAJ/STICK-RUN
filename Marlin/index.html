<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
   <head>
      <title>Marlinconnection</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <style type="text/css" media="screen">
         html,
         body {
         height: 100%;
         background-color: #ffffff;
         }
         body {
         margin: 0;
         padding: 0;
         overflow: hidden;
         }
         #flashContent {
         width: 100%;
         height: 100%;
         }
      </style>
      <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
      <script>
         const socket = new WebSocket('ws://10.2.88.162:22000/');

         // Connection opened
         socket.addEventListener('open', function(event) {
             console.log('on Open')
             socket.send('Hello Server!');
         });

         // Listen for messages
         socket.addEventListener('message', function(event) {
             console.log('onMessage')
             console.log('Message from server ', event.data);
         });
         socket.addEventListener('connection', function(event) {
             console.log('onNewConnection')
             console.log('Message from server ', event.data);
         });

         //Sending Messages
         function send(message) {
             socket.send("CLIENT:" + message)
         }

         //ITEM List that are tradabe
         public var hats = [ "redhat", "blackhat", "brownhat", "hoodhat", "crazyscihat", "snaphat", "chickhat", "monkhat", "hockeyhat", "greenpunk", "gifthat", "generalhat", "astronuthat", "chemistryhat", "kitchenhat", "wizardhat", "winterhat", "robberhat", "somberohat", "piratehat", "narutohat", "russiahat", "ninjaturtlehat", "imbatmanhat", "luishat", "vaderhat", "kinghat", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""];

         //After the marketplace trade is done
         private void tradeDone(Player player)
         {
         foreach (Player p in Players)
         {

         if (player.myTrader == p.ConnectUserId)
         {
         		p.Send("trade_done");
         		player.Send("trade_done");
         		player.OfferItem = "nooffer";
         		player.Busy = "0";
         		player.myTrader = "0";
         		p.OfferItem = "nooffer";
         		p.Busy = "0";
         		p.myTrader = "0";
                    	Console.WriteLine("trader = " + player.myTrader + p.myTrader);
         		updateRoomOffers(player);
         }
         }
         }

         //Locking the tradable Items
         private void trade_lock(Player player)
         {
         foreach (Player p in Players)
         {
         if (player.myTrader == p.ConnectUserId)
         {
         		p.Send("trade_locked");
         }
         }
         }

         //Leaving the tradable offers
         private void leave_offer(Player player)
         {
         foreach (Player p in Players)
         {
         if (player.myTrader == p.ConnectUserId)
         {
         		p.Send("partner_left");
         		p.myTrader = "0";
         		p.Busy = "0";
         		updateRoomOffers(p);
         }
         }
         player.myTrader = "0";
         }

         //Update the items of the player
         private void itemupdate(int itemnum,string item, Player player)
         {

         foreach (Player p in Players)
         {
         if (player.myTrader == p.ConnectUserId)
         {

         		p.Send("changeitem", itemnum,item);

         }

         }

         }

         //Accepting Marketplace trade items
         function trade_accept(items,itemk,player)
         {
            //Console.WriteLine("trader = " + player.myTrader);
            //  string[] bitems = items.Split(',');
            // List<string> bitems = new List<string>(items.Split(','));
             int howmany = 1;
             foreach (string item in bitems)
             {
                 if (item != "")
                 {
                     console.log();("howmany = " + howmany);
                     howmany = howmany + 1;
                 }
                 console.log();("howmany = " + howmany);
           }
         private void partnerreject(Player player)
          {
              foreach (Player p in Players)
              {
                  if (player.myTrader == p.ConnectUserId)
                  {
                       p.Send("rejected");
                       p.myTrader = "0";
                  }
              }
              player.Busy = "0";
              player.myTrader = "0";
              updateRoomOffers(player);
          }
      </script>
   </head>
   <body>
      <div id="flashContent">
         <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="550" height="400" id="Marlinconnection" align="middle">
            <param name="movie" value="Marlinconnection.swf" />
            <param name="quality" value="high" />
            <param name="bgcolor" value="#ffffff" />
            <param name="play" value="true" />
            <param name="loop" value="true" />
            <param name="wmode" value="window" />
            <param name="scale" value="showall" />
            <param name="menu" value="true" />
            <param name="devicefont" value="false" />
            <param name="salign" value="" />
            <param name="allowScriptAccess" value="sameDomain" />
						//IE
            <object type="application/x-shockwave-flash" data="Marlinconnection.swf" width="550" height="400">
               <param name="movie" value="Marlinconnection.swf" />
               <param name="quality" value="high" />
               <param name="bgcolor" value="#ffffff" />
               <param name="play" value="true" />
               <param name="loop" value="true" />
               <param name="wmode" value="window" />
               <param name="scale" value="showall" />
               <param name="menu" value="true" />
               <param name="devicefont" value="false" />
               <param name="salign" value="" />
               <param name="allowScriptAccess" value="sameDomain" />
               <!--<![endif]-->
               <a href="http://www.adobe.com/go/getflash">
               <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
               </a>
               <!--[if !IE]>-->
            </object>
            <!--<![endif]-->
         </object>
      </div>
   </body>
</html>
